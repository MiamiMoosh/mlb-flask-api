{% extends "_base.html" %}

{% block title %}{{ meta.title or "Shop ‚Äì First String" }}{% endblock %}
{% block description %}{{ meta.description or "Explore bold apparel for fans who live the game." }}{% endblock %}
{% block og_image %}{{ meta.image or "/static/images/seo/default-banner.jpg" }}{% endblock %}

{% block head %}

  <style>
    body { background: url("/static/images/firststring_bg.png") no-repeat center center fixed; background-size: cover; background-color: #000; font-family: 'Orbitron', sans-serif; color: white; margin: 0; overflow-x: hidden; }
    .header-wrapper { display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 80px; background-image: url("/static/images/firststring_bg.png"); background-repeat: no-repeat; background-size: cover; background-position: center; background-attachment: fixed; z-index: 9999; }
    .header-left, .header-right { width: 100%; display: flex; align-items: flex-start; }
    .header-left { justify-content: flex-end; padding-right: 50px; }
    .header-left img { max-width: 80%; width: 300px; object-fit: contain; }
    .main-menu { font-family: 'Canes', sans-serif; background: #1D1F21; }
    .main-menu ul { list-style: none; margin: 0; padding: 0; display: flex; font-size: 16px; }
    .main-menu ul li { position: relative; padding: 5px 10px; }
    .main-menu ul li a { color: #fff; text-decoration: none; font-size: 16px; }
    .dropdown-content, .submenu-content { display: none !important; position: absolute; background: #1D1F21; border: 1px solid #AA0000; min-width: 200px; z-index: 1000; }
    .dropdown:hover > .dropdown-content { display: block !important; }
    .submenu:hover > .submenu-content { display: block !important; }
    .wrapper { margin-top: 80px; display: flex; width: 100vw; position: relative; }
    .empty-container { flex: 1; }
    .dashboard-panel { flex: 1; padding: 20px; }
    #stats-container { display: flex; flex-direction: column; padding-right: 100px; }
    .shop-title { font-size: 24px; font-weight: bold; margin-bottom: 1rem; }
    .shop-filters { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 1rem; }
    .shop-filters select { padding: 6px; font-size: 14px; background: #111; color: white; border: 1px solid #666; border-radius: 4px; }
    .thumbnail-size-toggle { margin-bottom: 1rem; }
    #product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 30px; margin-top: 20px; }
    #product-grid.small .product-card { transform: scale(0.85); }
    #product-grid.medium .product-card { transform: scale(1); }
    #product-grid.large .product-card { transform: scale(1.25); }
    #product-grid.small { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); }
    #product-grid.medium { grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); }
    #product-grid.large { grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); }
    .product-card { background-color: #1c1c1c; border: 2px solid #AA0000; border-radius: 8px; padding: 16px; text-align: center; transition: 0.3s ease-in-out; }
    .product-card:hover { transform: translateY(-5px); box-shadow: 0 0 10px #AA0000; }
    .product-image { width: 100%; height: 200px; object-fit: cover; border-radius: 4px; }
    .product-title { font-size: 14px; font-weight: bold; margin-top: 10px; }
    .product-price { color: #C0C8B6; font-size: 12px; margin-top: 4px; }
  </style>
{% endblock %}

{% block content %}

  <div class="wrapper">
    <div class="empty-container"></div>
    <div class="dashboard-panel" id="stats-panel">
      <div id="stats-container">
        <div class="shop-title">Shop the Signature Collection</div>

        <div class="shop-filters">
          <select id="filter-sport" onchange="updateShopFilters()">
            <option value="">All Sports</option>
            <option value="baseball">Baseball</option>
            <option value="football">Football</option>
          </select>
          <select id="filter-city" onchange="updateShopFilters()">
            <option value="">All Cities</option>
            <option value="pittsburgh">Pittsburgh</option>
            <option value="chicago">Chicago</option>
          </select>
          <select id="filter-collection" onchange="updateShopFilters()">
            <option value="">All Collections</option>
            <option value="signature">Signature</option>
            <option value="fan-favorite">Fan Favorite</option>
          </select>
          <select id="filter-type" onchange="updateShopFilters()">
            <option value="">All Types</option>
            <option value="shirt">Shirt</option>
            <option value="hoodie">Hoodie</option>
            <option value="cap">Cap</option>
          </select>
        </div>

        <input
          type="text"
          id="product-search"
          placeholder="Search products, teams, players..."
          oninput="filterGrid(this.value)"
          style="padding: 6px; width: 100%; margin-bottom: 1rem;"
        />
        <div class="thumbnail-size-toggle" style="margin-bottom: 1rem;">
          <label style="margin-right: 10px;">üñºÔ∏è Thumbnail Size:</label>
          <button onclick="setThumbSize('small')">Small</button>
          <button onclick="setThumbSize('medium')">Medium</button>
          <button onclick="setThumbSize('large')">Large</button>
        </div>

        <div id="product-grid"></div>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}


  <script>
  const filters = {{ filters | tojson | safe }};
  const query = new URLSearchParams(filters).toString();

  fetch(`/shop-data?${query}`)
    .then(res => res.json())
    .then(data => {
      const grid = document.getElementById("product-grid");

      if (!Array.isArray(data) || !data.length) {
        grid.innerHTML = "<p>No products found.</p>";
        return;
      }

      data.forEach(product => {
        const card = document.createElement("div");
        card.className = "product-card";

        const img = document.createElement("img");
        img.className = "product-image";
        img.src = product.images?.[0]?.src || "";
        img.alt = product.title;

        const title = document.createElement("div");
        title.className = "product-title";
        title.textContent = product.title;

        const price = document.createElement("div");
        price.className = "product-price";
        const prices = product.variants?.map(v => v.price) || [];
        const minPrice = prices.length ? Math.min(...prices) : null;
        price.textContent = minPrice ? `From $${(minPrice / 100).toFixed(2)}` : "‚Äì";

        card.appendChild(img);
        card.appendChild(title);
        card.appendChild(price);
        grid.appendChild(card);
      });
    })
    .catch(err => {
      console.error("Error loading products:", err);
      document.getElementById("product-grid").innerHTML = "<p>Failed to load products.</p>";
    });

    function updateShopFilters() {
    const sport = document.getElementById("filter-sport").value;
    const city = document.getElementById("filter-city").value;
    const collection = document.getElementById("filter-collection").value;
    const type = document.getElementById("filter-type").value;

    const parts = [sport, city, collection, type].filter(Boolean);
    const path = parts.join("/");
    window.location.href = path ? `/shop/${path}` : "/shop";
  }

  function filterGrid(query) {
    query = query.toLowerCase();
    document.querySelectorAll(".product-card").forEach(card => {
      const text = card.innerText.toLowerCase();
      card.style.display = text.includes(query) ? "block" : "none";
    });
  }
  function setThumbSize(size) {
  const grid = document.getElementById("product-grid");
  grid.classList.remove("small", "medium", "large");
  grid.classList.add(size);
}
setThumbSize('medium'); // Default view

</script>

{% endblock %}